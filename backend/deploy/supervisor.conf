# Supervisor configuration for Trainings Backoffice on AlwaysData
#
# To use this configuration:
# 1. Copy this file content to AlwaysData control panel
# 2. Go to: Sites > Your Site (#993983) > Advanced > Process Manager
# 3. Add a new program with this configuration
#
# Or if you have SSH access:
# 1. Copy to: /home/y-b/.supervisor/conf.d/trainings-backoffice.conf
# 2. Run: supervisorctl reread
# 3. Run: supervisorctl update
# 4. Run: supervisorctl start trainings-backoffice

[program:trainings-backoffice]
# Command to run
command=/home/y-b/.local/bin/poetry run gunicorn -c gunicorn_config.py app.main:app

# Working directory
directory=/home/y-b/trainings-backoffice/backend

# Environment variables
environment=
    PATH="/home/y-b/.local/bin:/home/y-b/.poetry/bin:%(ENV_PATH)s",
    PYTHONPATH="/home/y-b/trainings-backoffice/backend",
    HOME="/home/y-b"

# User to run as (AlwaysData specific)
user=y-b

# Process management
numprocs=1
autostart=true
autorestart=true
startretries=3
startsecs=10

# Stop signals
stopsignal=TERM
stopwaitsecs=10
stopasgroup=true
killasgroup=true

# Logging
stdout_logfile=/home/y-b/trainings-backoffice/logs/supervisor-stdout.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=10
stdout_capture_maxbytes=0
stderr_logfile=/home/y-b/trainings-backoffice/logs/supervisor-stderr.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=10
stderr_capture_maxbytes=0

# Priority
priority=999

# Redirect stderr to stdout
redirect_stderr=false
